name: Run custom Ansible code
description: Run custom Ansible code to bootstrap instance
schemaVersion: 1.0
phases:
  - name: build
    steps:
      - name: InstallAndRunAnsible
        action: ExecuteBash
        inputs:
          commands:
            - ansible_playbook_folder="/home/ec2-user/sap-golden-ami"
            - rm -rf $ansible_playbook_folder
            - linux_distro=$(rpm -qf /etc/redhat-release)
            - if [[ $linux_distro == *"oraclelinux"* ]]; then
            -   sudo dnf install -y epel-release
            -   sudo dnf install ansible -y
            - else
            -   sudo yum install -y git ansible
            - fi
            - git clone https://github.com/guisesterheim/sap-golden-ami.git $ansible_playbook_folder
            - sudo ansible-playbook $ansible_playbook_folder/ansible/golden_amis/bootstrap_instance.yaml